<!DOCTYPE html>
<html>
  <head>
    <title>Cart | Southern Art Soap</title>
    <div th:replace="fragments/head"></div>
  </head>
  <body>
    <div th:replace="fragments/navbar"></div>
    <div class="container-fluid">
      <h2>Shopping Cart</h2>
      <div class="row">
        <div class="col-8">
          <div th:if="${cartDetailses.isEmpty()==true}">
            <h1>Your cart is empty</h1>
          </div>
          <table th:if="${cartDetailses.isEmpty()==false}" class="table table-hover">
            <thead>
              <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th class="text-center">Price</th>
                <th class="text-center">Total</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            <!-- TH to loop on cart details goes here   -->
            <div th:each="cartDetails :${cartDetailses}">
              <!-- put the form here?   -->
              <tr>
                <td class="col-8">
                  <div class="media">
                    <a class="thumbnail pull-left" href="#">
                      <!--appending Stat.index to a value in a thymeleaf for each loop gives the index value   -->
                      <img class="media-image img-thumbnail" th:src="@{${'/img/' + images[cartDetailsStat.index].getImgPath()}}" /> 
                    </a>
                    <div class="media-body">
                      <h4 class="media-heading"><a href="#"><span th:text="${cartDetails.getProduct.getName()}"></span></a></h4> <!--  product name -->
                    </div>
                  </div>
                </td>
                <form action="#" th:action="@{/cart/update/{id}(id=${cartDetails.id})}" th:object="${cartDetails}" method="post">
                    <td class="col-sm-1 col-md-1">
                    <!-- insert th:field for this th:field="*{quantity}"  -->
                      <input type="text" class="form-control text-center"  name="newQuantity" th:value="${cartDetails.getQuantity()}" />
                    </td>
                    <td class="col-sm-1 col-md-1 text-center" th:text="'$'+${cartDetails.getProduct.getPrice()}+'0'"></td> <!--Append 0 for formatting. Probably a superior solution with a thymleaf format option beginning with #   -->
                    <!--<img th:src="'/img/' + ${cartDetail.product.image[0].imgPath}" class="media-image img-thumbnail" />-->
                    <td class="col-sm-1 col-md-1 text-center" th:text="'$'+${cartDetails.getQuantity() * cartDetails.getProduct.getPrice()}+'0'"></td>
                    <td class="col-sm-1 col-md-1">
                      <button type="submit" class="btn btn-primary"><i class="fas fa-sync-alt"></i></button>
                </form>
<!-- <form action="#" th:action="@{~/blogposts/update/{id}(id=${blogPost.id})}" th:object="${blogPost}" method="GET"> -->
<form action="#" th:action="@{/cart/delete/{id}(id=${cartDetails.id})}" th:object:"${CartDetails}" method="post">
                  <!-- <input type="hidden" th:value="*{cartDetails.id}"/> -->
                  <button type="submit" class="btn btn-danger"><i class="far fa-trash-alt"></i></button>
                </form>
                    </td>
                  </tr>
              <!--  end of loop  -->
            </div>
            </tbody>
          </table>
        <div class="col">
          <div class="pt-4">
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                Cost of Goods
                <span th:text="${#numbers.formatCurrency(totalPrice)}"></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                Cost of Shipping
                <span>Gratis</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                <div>
                  <strong>The total amount</strong>
                </div>
                <span><strong th:text="${#numbers.formatCurrency(totalPrice)}"></strong></span>
              </li>
            </ul>

            <button type="button" class="btn btn-primary btn-block mb-2">Checkout</button>
            <a class="d-block text-center" href="/">Continue Shopping</a>
          </div>
        </div>
      </div>
    </div>
    <div th:replace="fragments/footer"></div>
    <div th:replace="fragments/scripts"></div>
  </body>
</html>
